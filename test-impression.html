<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Configurateur matières souples & rigides — Aperçu</title>
<style>
  :root{
    --violet:#5a2d82; --violet-2:#7838a7;
    --glass:rgba(255,255,255,.08);
    --glass-soft:rgba(255,255,255,.04);
    --txt:#f5f7ff;
    --accent:#c9b7ff;
    --radius:18px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    background:radial-gradient(circle at top left,var(--violet-2),var(--violet));
    min-height:100vh;
    color:var(--txt);
    padding:24px 12px 40px;
  }
  h1{text-align:center;margin:0 0 24px;font-weight:600}
  h2{margin-top:0;font-weight:500}
  .layout{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:minmax(0,2fr) minmax(260px,1fr);gap:18px;align-items:flex-start}
  @media(max-width:900px){.layout{grid-template-columns:1fr}}
  .step{
    display:none;
    margin:0 0 18px;
    padding:24px 20px 28px;
    border-radius:var(--radius);
    background:var(--glass);
    backdrop-filter:blur(16px);
    box-shadow:0 14px 40px rgba(0,0,0,.35);
  }
  .step.active{display:block}
  .grid{display:flex;flex-wrap:wrap;gap:14px;justify-content:center;margin-top:12px}
  .card{
    min-width:150px;padding:14px 16px;border-radius:14px;
    background:var(--glass-soft);
    border:1px solid rgba(255,255,255,.18);
    cursor:pointer;text-align:center;font-size:14px;
    transition:.18s ease-out;
  }
  .card:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.35);border-color:var(--accent)}
  .card.selected{border-color:var(--accent);background:rgba(201,183,255,.16)}
  button{
    width:100%;margin-top:18px;padding:12px 16px;border-radius:999px;
    border:none;background:linear-gradient(135deg,var(--violet-2),var(--accent));
    color:#12081e;font-weight:600;cursor:pointer;font-size:14px;
  }
  button.secondary{
    background:transparent;color:var(--txt);
    border:1px solid rgba(255,255,255,.35);margin-top:10px;
  }
  label{display:block;margin-top:12px;margin-bottom:4px;font-size:13px}
  select,input{
    width:100%;padding:10px 11px;border-radius:12px;
    border:1px solid rgba(255,255,255,.25);
    background:rgba(5,5,20,.45);color:var(--txt);
  }
  select:focus,input:focus{outline:2px solid var(--accent);outline-offset:1px}
  #resume{font-size:14px;line-height:1.5;background:var(--glass-soft);
    padding:12px 14px;border-radius:14px;border:1px solid rgba(255,255,255,.18)}
  .preview{
    position:sticky;top:20px;
    padding:20px 18px 22px;
    border-radius:var(--radius);
    background:var(--glass);
    backdrop-filter:blur(16px);
    box-shadow:0 12px 32px rgba(0,0,0,.38);
  }
  .preview-title{font-size:15px;font-weight:600;margin-bottom:10px}
  .preview-box{
    margin-top:10px;
    border-radius:14px;
    background:rgba(5,5,20,.55);
    border:1px dashed rgba(255,255,255,.25);
    height:180px;
    display:flex;align-items:center;justify-content:center;
    font-size:13px;text-align:center;padding:10px;
  }
  .preview-meta{margin-top:10px;font-size:13px;line-height:1.5;opacity:.9}
</style>
</head>
<body>
<h1>Configurateur matières souples & rigides — Aperçu</h1>
<div class="layout">
  <div>
    <!-- ÉTAPES -->
    <div id="step1" class="step active">
      <h2>1. Choix du type de matière</h2>
      <div class="grid">
        <div class="card" data-type="souple">Matière souple</div>
        <div class="card" data-type="rigide">Matière rigide</div>
      </div>
    </div>

    <div id="step2" class="step">
      <h2>2. Avec ou sans impression ?</h2>
      <div class="grid">
        <div class="card" data-print="avec">Avec impression</div>
        <div class="card" data-print="sans">Sans impression</div>
      </div>
      <button class="secondary" type="button" data-back="1">⬅ Retour</button>
    </div>

    <div id="step3" class="step">
      <h2>3. Choix du support</h2>
      <div id="support-grid" class="grid"></div>
      <button class="secondary" type="button" data-back="2">⬅ Retour</button>
    </div>

    <div id="step4b" class="step">
      <h2>4. Blanc de soutien</h2>
      <label>Blanc de soutien</label>
      <select id="blanc"></select>
      <button id="btnBlancNext" type="button">Continuer</button>
      <button class="secondary" type="button" data-back="3">⬅ Retour</button>
    </div>

    <div id="step4" class="step">
      <h2>5. Type de découpe</h2>
      <label>Découpe</label>
      <select id="decoupe"></select>
      <button id="btnDecoupeNext" type="button">Continuer</button>
      <button class="secondary" type="button" id="btnDecoupeBack">⬅ Retour</button>
    </div>

    <div id="step5" class="step">
      <h2>6. Lamination</h2>
      <label>Lamination</label>
      <select id="lamination"></select>
      <button id="btnLaminNext" type="button">Continuer</button>
      <button class="secondary" type="button" data-back="4">⬅ Retour</button>
    </div>

    <div id="step6" class="step">
      <h2>7. Dimensions & quantité</h2>
      <label>Largeur (mm)</label><input id="larg" type="number" min="10" />
      <label>Hauteur (mm)</label><input id="haut" type="number" min="10" />
      <label>Quantité</label><input id="qte" type="number" value="1" min="1" />
      <button type="button" id="btnShowResume">Voir le récapitulatif</button>
      <button class="secondary" type="button" data-back="5">⬅ Retour</button>
    </div>

    <div id="step7" class="step">
      <h2>Récapitulatif</h2>
      <div id="resume"></div>
      <button id="btnAdd" type="button">Ajouter cette ligne au devis (aperçu)</button>
      <button class="secondary" type="button" data-back="6">⬅ Modifier</button>
    </div>
  </div>

  <!-- PRÉVISUALISATION -->
  <aside class="preview">
    <div class="preview-title">Prévisualisation</div>
    <div id="preview-box" class="preview-box">Commencez le configurateur pour voir un aperçu du produit.</div>
    <div id="preview-meta" class="preview-meta"></div>
  </aside>
</div>

<script>
let typeMatiere=null,typeImpression=null,supportChoisi=null,
    blancChoisi=null,decoupeChoisie=null,laminationChoisie=null,
    supportAOptionBlanc=false;

function goTo(n){
  document.querySelectorAll('.step').forEach(s=>s.classList.remove('active'));
  const bloc=document.getElementById('step'+n);
  if(bloc) bloc.classList.add('active');
  window.scrollTo({top:0,behavior:'smooth'});
}

// --- Données ---
const supports={
 souple:{
  avec:[
   'Vinyl dépoli','Vinyl polymère conformable','Vinyl polymère',
   'Vinyl teinté masse','Vinyl microperforé','Bâche couleurs','Adhésif dépoli'
  ],
  sans:['Vinyl dépoli','Vinyl polymère teinté masse','Vinyl microperforé']
 },
 rigide:{
  avec:[
   'PVC 3 mm','PVC 5 mm','PVC 6 mm','PVC 8 mm','PVC 10 mm',
   'Akilux 3.5 mm','Plexi 6 mm','Plexi 8 mm','Plexi 10 mm','ACM 3 mm'
  ],
  sans:[]
 }
};

const blancOptions={
 'Vinyl dépoli':['Avec blanc de soutien','Sans blanc de soutien'],
 'Vinyl polymère':['Avec blanc','Sans blanc'],
 'Vinyl polymère conformable':['Avec blanc','Sans blanc'],
 'Vinyl teinté masse':['Avec blanc','Sans blanc'],
 'Vinyl polymère teinté masse':['Avec blanc','Sans blanc'],
 'Plexi 6 mm':['Avec blanc','Sans blanc'],
 'Plexi 8 mm':['Avec blanc','Sans blanc'],
 'Plexi 10 mm':['Avec blanc','Sans blanc']
};

const decoupes={
 'Vinyl microperforé':['Découpe au format','Découpe complexe'],
 'Vinyl dépoli':['Découpe au format','Découpe complexe'],
 'Vinyl polymère':['Découpe au format','Découpe complexe'],
 'Vinyl polymère conformable':['Découpe au format','Découpe complexe'],
 'Vinyl teinté masse':['Découpe au format','Découpe complexe'],
 'Vinyl polymère teinté masse':['Découpe au format','Découpe complexe'],
 'Adhésif dépoli':['Découpe au format','Découpe complexe'],
 'Bâche couleurs':['Avec œillets','Sans œillets'],
 'PVC 3 mm':['Découpe au format','Découpe complexe'],
 'PVC 5 mm':['Découpe au format','Découpe complexe'],
 'PVC 6 mm':['Découpe au format','Découpe complexe'],
 'PVC 8 mm':['Découpe au format','Découpe complexe'],
 'PVC 10 mm':['Découpe au format','Découpe complexe'],
 'Akilux 3.5 mm':['Découpe au format','Découpe complexe'],
 'Plexi 6 mm':['Découpe au format','Découpe complexe'],
 'Plexi 8 mm':['Découpe au format','Découpe complexe'],
 'Plexi 10 mm':['Découpe au format','Découpe complexe'],
 'ACM 3 mm':['Découpe au format','Découpe complexe']
};

const laminations={
 'Vinyl microperforé':{format:['Pas de lamination'],complexe:['Pas de lamination']},
 'Vinyl dépoli':{format:['Pas de lamination'],complexe:['Pas de lamination']},
 'Vinyl polymère conformable':{format:['Avec lamination'],complexe:['Avec lamination']},
 'Vinyl polymère':{format:['Avec lamination'],complexe:['Avec lamination']},
 'Vinyl teinté masse':{format:['Avec lamination'],complexe:['Avec lamination']},
 'Vinyl polymère teinté masse':{format:['Avec lamination','Sans lamination'],complexe:['Avec lamination','Sans lamination']},
 'Adhésif dépoli':{format:['Sans lamination'],complexe:['Sans lamination']},
 'Bâche couleurs':{format:['Sans lamination'],complexe:['Sans lamination']},
 'PVC 3 mm':{format:['Pas de lamination'],complexe:['Pas de lamination']},
 'PVC 5 mm':{format:['Pas de lamination'],complexe:['Pas de lamination']},
 'PVC 6 mm':{format:['Pas de lamination'],complexe:['Pas de lamination']},
 'PVC 8 mm':{format:['Pas de lamination'],complexe:['Pas de lamination']},
 'PVC 10 mm':{format:['Pas de lamination'],complexe:['Pas de lamination']},
 'Akilux 3.5 mm':{format:['Pas de lamination'],complexe:['Pas de lamination']},
 'Plexi 6 mm':{format:['Pas de lamination'],complexe:['Pas de lamination']},
 'Plexi 8 mm':{format:['Pas de lamination'],complexe:['Pas de lamination']},
 'Plexi 10 mm':{format:['Pas de lamination'],complexe:['Pas de lamination']},
 'ACM 3 mm':{format:['Pas de lamination'],complexe:['Pas de lamination']}
};

function updatePreview(){
  const box=document.getElementById('preview-box');
  const meta=document.getElementById('preview-meta');
  if(!supportChoisi){
    box.textContent="Commencez le configurateur pour voir un aperçu du produit.";
    meta.textContent="";
    return;
  }
  // Contenu principal dans la boîte
  box.innerHTML =
    supportChoisi + '<br>' +
    (decoupeChoisie || '') + '<br>' +
    (laminationChoisie || '');

  // Détails texte en dessous
  const L=document.getElementById('larg').value;
  const H=document.getElementById('haut').value;
  const q=document.getElementById('qte').value;
  const infos=[];
  infos.push('Type : '+(typeMatiere==='souple'?'Matière souple':'Matière rigide'));
  infos.push('Impression : '+(typeImpression==='avec'?'Avec impression':'Sans impression'));
  if(blancChoisi) infos.push('Blanc de soutien : '+blancChoisi);
  if(decoupeChoisie) infos.push('Découpe : '+decoupeChoisie);
  if(laminationChoisie) infos.push('Lamination : '+laminationChoisie);
  if(L&&H) infos.push('Dimensions : '+L+' × '+H+' mm');
  if(q) infos.push('Quantité : '+q);
  meta.innerHTML = infos.join('<br>');
}

function remplirSupports(){
  const grid=document.getElementById('support-grid');
  grid.innerHTML='';
  const liste=(supports[typeMatiere]&&supports[typeMatiere][typeImpression])||[];
  liste.forEach(nom=>{
    const div=document.createElement('div');
    div.className='card';
    div.textContent=nom;
    div.addEventListener('click',()=>{
      supportChoisi=nom;decoupeChoisie=null;laminationChoisie=null;blancChoisi=null;
      supportAOptionBlanc=!!blancOptions[nom];
      if(supportAOptionBlanc){
        const sel=document.getElementById('blanc');
        sel.innerHTML='';
        blancOptions[nom].forEach(opt=>{
          const o=document.createElement('option');o.value=opt;o.textContent=opt;sel.appendChild(o);
        });
        blancChoisi=sel.value;
        goTo('4b'); // aller à l'étape blanc de soutien
      }else{
        remplirDecoupe();
        goTo(4);
      }
      updatePreview();
    });
    grid.appendChild(div);
  });
}

function remplirDecoupe(){
  const sel=document.getElementById('decoupe');
  sel.innerHTML='';
  const liste=decoupes[supportChoisi]||['Découpe au format'];
  liste.forEach(opt=>{
    const o=document.createElement('option');o.value=opt;o.textContent=opt;sel.appendChild(o);
  });
  decoupeChoisie=sel.value;
}

function remplirLamination(){
  const sel=document.getElementById('lamination');
  sel.innerHTML='';
  const mode=(decoupeChoisie&&decoupeChoisie.toLowerCase().includes('complexe'))?'complexe':'format';
  const config=laminations[supportChoisi];
  const liste=(config&&config[mode])||['Pas de lamination'];
  liste.forEach(opt=>{
    const o=document.createElement('option');o.value=opt;o.textContent=opt;sel.appendChild(o);
  });
  laminationChoisie=sel.value;
}

function genererResume(){
  const L=document.getElementById('larg').value;
  const H=document.getElementById('haut').value;
  const q=document.getElementById('qte').value;
  const lignes=[];
  lignes.push('<b>Matière :</b> '+(typeMatiere==='souple'?'Matière souple':'Matière rigide'));
  lignes.push('<b>Support :</b> '+(supportChoisi||'-'));
  lignes.push('<b>Impression :</b> '+(typeImpression==='avec'?'Avec impression':'Sans impression'));
  if(blancChoisi) lignes.push('<b>Blanc de soutien :</b> '+blancChoisi);
  if(decoupeChoisie) lignes.push('<b>Découpe :</b> '+decoupeChoisie);
  if(laminationChoisie) lignes.push('<b>Lamination :</b> '+laminationChoisie);
  lignes.push('<b>Dimensions :</b> '+(L||'-')+' × '+(H||'-')+' mm');
  lignes.push('<b>Quantité :</b> '+(q||'1'));
  document.getElementById('resume').innerHTML=lignes.join('<br>');
  updatePreview();
}

// Initialisation des listeners

document.addEventListener('DOMContentLoaded',()=>{
  // Étape 1
  document.querySelectorAll('#step1 .card').forEach(card=>{
    card.addEventListener('click',()=>{
      typeMatiere=card.dataset.type;typeImpression=null;supportChoisi=null;
      goTo(2);updatePreview();
    });
  });
  // Étape 2
  document.querySelectorAll('#step2 .card').forEach(card=>{
    card.addEventListener('click',()=>{
      typeImpression=card.dataset.print;supportChoisi=null;
      remplirSupports();goTo(3);updatePreview();
    });
  });
  // Boutons retour génériques
  document.querySelectorAll('button[data-back]').forEach(btn=>{
    btn.addEventListener('click',()=>goTo(btn.getAttribute('data-back')));
  });
  // Blanc de soutien → découpe
  document.getElementById('btnBlancNext').addEventListener('click',()=>{
    blancChoisi=document.getElementById('blanc').value;remplirDecoupe();goTo(4);updatePreview();
  });
  // Retour découpe
  document.getElementById('btnDecoupeBack').addEventListener('click',()=>{
    if(supportAOptionBlanc) goTo('4b'); else goTo(3);
  });
  // Découpe → lamination
  document.getElementById('btnDecoupeNext').addEventListener('click',()=>{
    decoupeChoisie=document.getElementById('decoupe').value;remplirLamination();goTo(5);updatePreview();
  });
  // Lamination → dimensions
  document.getElementById('btnLaminNext').addEventListener('click',()=>{
    laminationChoisie=document.getElementById('lamination').value;goTo(6);updatePreview();
  });
  // Bouton récap
  document.getElementById('btnShowResume').addEventListener('click',()=>{genererResume();goTo(7);});
  // Saisie live
  ['larg','haut','qte'].forEach(id=>{
    document.getElementById(id).addEventListener('input',updatePreview);
  });
  // Ajouter au devis (aperçu seulement)
  document.getElementById('btnAdd').addEventListener('click',()=>{
    alert('En production : cette ligne serait ajoutée au devis de la page index.');
  });

  updatePreview();
});
</script>
</body>
</html>

